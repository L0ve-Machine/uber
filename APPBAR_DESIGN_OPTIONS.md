# AppBar デザインオプション設計書

## 現状分析

### 現在のAppBar構成

**ホーム画面のAppBar**:
```
┌─────────────────────────────────────────────┐
│ FoodHub          [カート] [プロフィール]    │
└─────────────────────────────────────────────┘
```

- タイトル: "FoodHub"
- 右側アクション1: カートアイコン + バッジ
- 右側アクション2: プロフィールアイコン → ダイアログ

**その他の画面のAppBar**:
- タイトルのみ（例: "注文履歴"、"お気に入り"）
- 戻るボタン（自動生成）

---

## 課題

ボトムナビゲーション導入時のAppBar設計をどうするか？

**考慮点**:
1. カートアイコンは全タブで必要か？
2. プロフィールアイコンはどうするか？
3. タブごとにAppBarを変えるか、統一するか？
4. タイトル表示はどうするか？

---

## オプション1: ミニマル（カートのみ残す）

### 設計

**ホームタブ**:
```
┌─────────────────────────────────────────────┐
│ FoodHub                      [カート]       │
└─────────────────────────────────────────────┘
```

**注文タブ**:
```
┌─────────────────────────────────────────────┐
│ 注文履歴                     [カート]       │
└─────────────────────────────────────────────┘
```

**お気に入りタブ**:
```
┌─────────────────────────────────────────────┐
│ お気に入り                   [カート]       │
└─────────────────────────────────────────────┘
```

**その他タブ**:
```
┌─────────────────────────────────────────────┐
│ メニュー                                    │
└─────────────────────────────────────────────┘
```

### 変更点

- プロフィールアイコン削除
- カートアイコンは全タブで表示（買い物しやすい）
- プロフィール関連は「その他タブ」に集約

### メリット

- シンプル・スッキリ
- カートは常にアクセス可能
- ボトムナビとの役割分担が明確

### デメリット

- プロフィールへのアクセスが1段階増える
  - 現在: 右上アイコン → ダイアログ → プロフィール
  - 変更後: その他タブ → プロフィール

---

## オプション2: 完全削除（AppBarをタイトルのみに）

### 設計

**ホームタブ**:
```
┌─────────────────────────────────────────────┐
│ FoodHub                                     │
└─────────────────────────────────────────────┘
```

**注文タブ**:
```
┌─────────────────────────────────────────────┐
│ 注文履歴                                     │
└─────────────────────────────────────────────┘
```

**お気に入りタブ**:
```
┌─────────────────────────────────────────────┐
│ お気に入り                                   │
└─────────────────────────────────────────────┘
```

**その他タブ**:
```
┌─────────────────────────────────────────────┐
│ メニュー                                     │
└─────────────────────────────────────────────┘
```

### 変更点

- カートアイコン削除
- プロフィールアイコン削除
- タイトルのみのシンプルなAppBar

### カートへのアクセス

**方法A**: レストラン詳細画面のFloatingActionButtonのみ
```dart
// 既存の実装
floatingActionButton: cartItemCount > 0
  ? FloatingActionButton.extended(
      icon: Icon(Icons.shopping_cart),
      label: Text('カート ($cartItemCount)'),
    )
  : null
```

**方法B**: ホームタブの検索バー下に「カートを見る」バナー
```dart
if (cartItemCount > 0)
  Container(
    color: Colors.black,
    padding: EdgeInsets.all(12),
    child: Row(
      children: [
        Icon(Icons.shopping_cart, color: Colors.white),
        Text('カート: $cartItemCount件', style: TextStyle(color: Colors.white)),
        Spacer(),
        TextButton(child: Text('見る'), onPressed: () => ...),
      ],
    ),
  )
```

### メリット

- 非常にシンプル
- 画面が広く使える
- タイトルが強調される

### デメリット

- カートへのアクセスが悪くなる
- レストラン閲覧中にカートが見えない

---

## オプション3: 現状維持 + ボトムナビ追加

### 設計

**ホームタブ**:
```
┌─────────────────────────────────────────────┐
│ FoodHub          [カート] [プロフィール]    │
└─────────────────────────────────────────────┘
```

**注文タブ**:
```
┌─────────────────────────────────────────────┐
│ 注文履歴                     [カート]       │
└─────────────────────────────────────────────┘
```

**お気に入りタブ**:
```
┌─────────────────────────────────────────────┐
│ お気に入り                   [カート]       │
└─────────────────────────────────────────────┘
```

**その他タブ**:
```
┌─────────────────────────────────────────────┐
│ メニュー                                    │
└─────────────────────────────────────────────┘
```

### 変更点

- ホームタブのみ現状維持（カート + プロフィール）
- 他のタブはカートアイコンのみ
- プロフィールダイアログは**簡略化**

**プロフィールダイアログの簡略化案**:
```dart
// 削除する項目:
- ❌ 注文履歴（ボトムナビの「注文」タブへ）
- ❌ お気に入り（ボトムナビのタブへ）
- ❌ マイレビュー（その他タブへ）
- ❌ 住所管理（その他タブへ）

// 残す項目:
- ✅ ユーザー情報表示
- ✅ プロフィール編集（クイックアクセス）
- ✅ ログアウト
```

### メリット

- 段階的な移行（既存UIの大部分を保持）
- カートへのアクセス性維持
- プロフィールへのクイックアクセスも維持

### デメリット

- ダイアログとボトムナビで機能が重複
- やや冗長

---

## オプション4: タブ別AppBar（柔軟）

### 設計

**ホームタブ**:
```
┌─────────────────────────────────────────────┐
│ FoodHub          [カート] [プロフィール]    │
└─────────────────────────────────────────────┘
```
- 現状維持（買い物体験を優先）

**注文タブ**:
```
┌─────────────────────────────────────────────┐
│ 注文履歴         [フィルター] [カート]      │
└─────────────────────────────────────────────┘
```
- ステータスフィルターをAppBarに移動
- カートは維持

**お気に入りタブ**:
```
┌─────────────────────────────────────────────┐
│ お気に入り                   [カート]       │
└─────────────────────────────────────────────┘
```
- シンプル

**その他タブ**:
```
┌─────────────────────────────────────────────┐
│ メニュー                     [設定]         │
└─────────────────────────────────────────────┘
```
- 設定アイコン追加（通知設定など）

### 変更点

- 各タブで最適なAppBarを個別設計
- カートは買い物関連タブ（ホーム・注文・お気に入り）のみ表示
- プロフィールダイアログは削除

### メリット

- 各タブに最適化されたUI
- 柔軟性が高い
- 無駄がない

### デメリット

- 実装コストがやや高い
- タブごとに一貫性が低い

---

## オプション5: ハイブリッド（推奨）

### 設計

**ホームタブ**:
```
┌─────────────────────────────────────────────┐
│ FoodHub                      [カート]       │
└─────────────────────────────────────────────┘
```
- プロフィールアイコン削除（ボトムナビの「その他」で代替）
- カート維持

**注文タブ**:
```
┌─────────────────────────────────────────────┐
│ 注文履歴                                    │
└─────────────────────────────────────────────┘
```
- カートアイコンなし（注文確認画面では不要）
- シンプルに

**お気に入りタブ**:
```
┌─────────────────────────────────────────────┐
│ お気に入り                   [カート]       │
└─────────────────────────────────────────────┘
```
- カート維持（お気に入りから注文する可能性）

**その他タブ**:
```
┌─────────────────────────────────────────────┐
│ メニュー                                    │
└─────────────────────────────────────────────┘
```
- アイコンなし（設定画面として）

### ルール

**カートアイコン表示条件**:
- ホームタブ: 表示（買い物のメイン画面）
- 注文タブ: 非表示（過去の注文を見る画面）
- お気に入りタブ: 表示（そこから注文する可能性）
- その他タブ: 非表示（設定画面）

**プロフィールアイコン**:
- 全タブで削除
- ボトムナビの「その他」タブで代替

### メリット

- シンプルかつ実用的
- 買い物体験を損なわない
- ボトムナビとの役割分担が明確
- 実装コストが低い

### デメリット

- なし（バランスが良い）

---

## 各オプションの比較表

| 項目 | オプション1 | オプション2 | オプション3 | オプション4 | オプション5 |
|------|-----------|-----------|-----------|-----------|-----------|
| カート（ホーム） | 全タブ | なし | 全タブ | ホームのみ | ホームのみ |
| カート（注文） | 全タブ | なし | 全タブ | あり | なし |
| カート（お気に入り） | 全タブ | なし | 全タブ | あり | あり |
| プロフィールアイコン | なし | なし | ホームのみ | なし | なし |
| プロフィールダイアログ | なし | なし | 簡略版 | なし | なし |
| 実装コスト | 低 | 最低 | 中 | 高 | 低 |
| UX品質 | 良 | 普通 | 良 | 最良 | 最良 |

---

## 推奨: オプション5（ハイブリッド）

### 理由

1. **買い物体験を最優先**
   - ホームとお気に入りでカート常時アクセス可能
   - レストラン閲覧中にカートを確認しやすい

2. **無駄を排除**
   - 注文タブやその他タブでカート不要
   - プロフィールアイコンは冗長（ボトムナビで代替）

3. **実装が簡単**
   - タブごとに条件分岐で表示切り替え
   - 既存AppBarをほぼ維持

4. **モダンで直感的**
   - 業界標準のパターン
   - ユーザーが迷わない

---

## 実装方針（オプション5採用時）

### MainNavigationScreen の AppBar 制御

```dart
class _MainNavigationScreenState extends State<MainNavigationScreen> {
  int _currentIndex = 0;

  // 各タブのAppBarを定義
  PreferredSizeWidget _buildAppBar() {
    switch (_currentIndex) {
      case 0: // ホーム
        return AppBar(
          title: Text('FoodHub'),
          backgroundColor: Colors.white,
          foregroundColor: Colors.black,
          actions: [
            // カートアイコン（バッジ付き）
            _buildCartIcon(),
          ],
        );

      case 1: // 注文
        return AppBar(
          title: Text('注文履歴'),
          backgroundColor: Colors.white,
          foregroundColor: Colors.black,
          // アイコンなし
        );

      case 2: // お気に入り
        return AppBar(
          title: Text('お気に入り'),
          backgroundColor: Colors.white,
          foregroundColor: Colors.black,
          actions: [
            // カートアイコン
            _buildCartIcon(),
          ],
        );

      case 3: // その他
        return AppBar(
          title: Text('メニュー'),
          backgroundColor: Colors.white,
          foregroundColor: Colors.black,
          // アイコンなし
        );

      default:
        return AppBar(title: Text('FoodHub'));
    }
  }

  Widget _buildCartIcon() {
    return Consumer(
      builder: (context, ref, _) {
        final cartItemCount = ref.watch(cartItemCountProvider);
        return Stack(
          alignment: Alignment.center,
          children: [
            IconButton(
              icon: Icon(Icons.shopping_cart),
              onPressed: () => Navigator.pushNamed(context, '/customer/cart'),
            ),
            if (cartItemCount > 0)
              Positioned(
                right: 8,
                top: 8,
                child: Container(
                  padding: EdgeInsets.all(4),
                  decoration: BoxDecoration(
                    color: Colors.red,
                    shape: BoxShape.circle,
                  ),
                  constraints: BoxConstraints(minWidth: 18, minHeight: 18),
                  child: Text('$cartItemCount',
                    style: TextStyle(color: Colors.white, fontSize: 10)),
                ),
              ),
          ],
        );
      },
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: _buildAppBar(),  // タブに応じたAppBar
      body: IndexedStack(
        index: _currentIndex,
        children: _screens,
      ),
      bottomNavigationBar: BottomNavigationBar(...),
    );
  }
}
```

---

### 子画面のAppBar調整

**重要**: 各タブの画面から AppBar を削除

```dart
// 変更前: HomeScreen
class HomeScreen extends ConsumerStatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(...),  // ← これを削除
      body: ...,
    );
  }
}

// 変更後: HomeScreen
class HomeScreen extends ConsumerStatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Column(  // Scaffoldではなく、bodyの内容だけ返す
      children: [
        // 検索バー
        Container(...),
        // カテゴリフィルター
        _buildCategoryFilter(),
        // レストラン一覧
        Expanded(...),
      ],
    );
  }
}
```

**理由**: MainNavigationScreen が AppBar を管理するため

---

## 詳細画面（レストラン詳細・注文詳細など）のAppBar

### 方針

**詳細画面は独自のAppBarを持つ**（現状維持）

```dart
// restaurant_detail_screen.dart
return Scaffold(
  appBar: AppBar(
    leading: BackButton(),  // 自動生成
    title: Text(restaurant.name),
    actions: [
      // お気に入りボタン
      _buildFavoriteButton(),
    ],
  ),
  body: ...,
  floatingActionButton: ...,  // カートFAB
);
```

**理由**:
- 詳細画面はモーダル的な扱い（別レイヤー）
- ボトムナビは非表示になる（Navigatorのスタック上）
- 独自のAppBarで戻るボタンが必要

---

## 他アプリの参考分析

### Uber Eats

**ボトムナビタブ**:
- ホーム
- 検索
- 注文
- アカウント

**AppBar**:
- ホーム: タイトル + カート
- 注文: タイトルのみ
- アカウント: タイトルのみ

→ **カートは買い物関連タブのみ**

---

### 出前館

**ボトムナビタブ**:
- ホーム
- 注文履歴
- お気に入り
- マイページ

**AppBar**:
- ホーム: タイトル + カート + 通知
- 注文履歴: タイトルのみ
- お気に入り: タイトル + カート
- マイページ: タイトルのみ

→ **カートはホームとお気に入りのみ**

---

### Amazon

**AppBar**:
- ホーム: 検索バー + カート
- 注文: タイトル + カート
- その他: タイトルのみ

→ **カートはほぼ全タブ**（ECサイト特有）

---

## 推奨設計の詳細（オプション5）

### 実装イメージ

```
┌─────────────────────────────────────────────┐
│                   AppBar                     │
│  - タブ0: "FoodHub" + [カート]              │
│  - タブ1: "注文履歴"                         │
│  - タブ2: "お気に入り" + [カート]           │
│  - タブ3: "メニュー"                         │
├─────────────────────────────────────────────┤
│                                              │
│              各タブのコンテンツ               │
│                                              │
│  - タブ0: レストラン一覧（現在のまま）        │
│  - タブ1: 注文履歴 + 追跡ボタン              │
│  - タブ2: お気に入りレストラン               │
│  - タブ3: 設定メニュー一覧                   │
│                                              │
├─────────────────────────────────────────────┤
│           BottomNavigationBar                │
│  [ホーム] [注文] [お気に入り] [その他]      │
└─────────────────────────────────────────────┘
```

### タブごとの役割整理

| タブ | 主な用途 | AppBar右側 | 特徴 |
|------|---------|-----------|------|
| ホーム | レストラン検索・閲覧 | カート | 買い物のメイン |
| 注文 | 注文履歴・追跡 | なし | 過去の確認・追跡 |
| お気に入り | お気に入りから注文 | カート | 買い物のサブ |
| その他 | 設定・プロフィール | なし | 管理画面 |

---

## オプション比較推奨度

| オプション | 推奨度 | 理由 |
|----------|-------|------|
| オプション1 | ★★★☆☆ | シンプルだが、カートが常に表示されて邪魔かも |
| オプション2 | ★★☆☆☆ | カートアクセスが悪すぎる |
| オプション3 | ★★☆☆☆ | 冗長（ダイアログとボトムナビで重複） |
| オプション4 | ★★★★☆ | 最良だが実装コスト高 |
| オプション5 | ★★★★★ | バランスが良い（推奨） |

---

## 実装時の注意点

### 1. 画面の再構築

既存の各画面は Scaffold を返していますが、MainNavigationScreen が親 Scaffold になるため:

**パターンA**: 子画面から Scaffold を削除（AppBarも削除）
```dart
// HomeScreen を Widget に変更
class HomeScreen extends ConsumerStatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Column(...);  // Scaffoldなし
  }
}
```

**パターンB**: 子画面は Scaffold を保持、AppBarのみ削除
```dart
class HomeScreen extends ConsumerStatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // appBar: なし
      body: Column(...),
    );
  }
}
```

**推奨**: パターンB（Scaffoldは保持、AppBarのみ削除）

---

### 2. カートアイコンの共通化

カートアイコンのコードが重複するため、ウィジェットとして共通化:

```dart
// 新規ファイル: lib/shared/widgets/cart_icon_button.dart

class CartIconButton extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final cartItemCount = ref.watch(cartItemCountProvider);

    return Stack(
      alignment: Alignment.center,
      children: [
        IconButton(
          icon: Icon(Icons.shopping_cart),
          onPressed: () => Navigator.pushNamed(context, '/customer/cart'),
        ),
        if (cartItemCount > 0)
          Positioned(
            right: 8,
            top: 8,
            child: Container(
              padding: EdgeInsets.all(4),
              decoration: BoxDecoration(
                color: Colors.red,
                shape: BoxShape.circle,
              ),
              child: Text('$cartItemCount', ...),
            ),
          ),
      ],
    );
  }
}
```

---

### 3. 戻るボタンの処理

詳細画面（レストラン詳細、注文詳細など）から戻る場合:
- 自動的に MainNavigationScreen に戻る
- タブ位置は保持される（IndexedStack の効果）

---

## まとめ

### 推奨設計: オプション5（ハイブリッド）

**AppBar構成**:
- ホーム: タイトル + カート
- 注文: タイトルのみ
- お気に入り: タイトル + カート
- その他: タイトルのみ

**変更点**:
- プロフィールダイアログ削除
- 右上のプロフィールアイコン削除
- カートは買い物関連タブのみ表示

**メリット**:
- 今のレストラン一覧は完全に維持
- 主要機能へのアクセス改善
- シンプルでモダン
- 実装コストが低い

この設計で進めてよろしいでしょうか？それとも別のオプションをご希望ですか？
